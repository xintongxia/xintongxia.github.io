"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ImmutableFeatureCollection = void 0;

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance"); }

function _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === "[object Arguments]") return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var ImmutableFeatureCollection =
/*#__PURE__*/
function () {
  function ImmutableFeatureCollection(featureCollection) {
    _classCallCheck(this, ImmutableFeatureCollection);

    _defineProperty(this, "featureCollection", void 0);

    this.featureCollection = featureCollection;
  }

  _createClass(ImmutableFeatureCollection, [{
    key: "getObject",
    value: function getObject() {
      return this.featureCollection;
    }
    /**
     * Replaces the position deeply nested withing the given feature's geometry.
     * Works with Point, MultiPoint, LineString, MultiLineString, Polygon, and MultiPolygon.
     *
     * @param featureIndex The index of the feature to update
     * @param positionIndexes An array containing the indexes of the position to replace
     * @param updatedPosition The updated position to place in the result (i.e. [lng, lat])
     *
     * @returns A new `ImmutableFeatureCollection` with the given position replaced. Does not modify this `ImmutableFeatureCollection`.
     */

  }, {
    key: "replacePosition",
    value: function replacePosition(featureIndex, positionIndexes, updatedPosition) {
      var geometry = this.featureCollection.features[featureIndex].geometry;
      var isPolygonal = geometry.type === 'Polygon' || geometry.type === 'MultiPolygon';

      var updatedGeometry = _objectSpread({}, geometry, {
        coordinates: immutablyReplacePosition(geometry.coordinates, positionIndexes, updatedPosition, isPolygonal)
      });

      return this.replaceGeometry(featureIndex, updatedGeometry);
    }
    /**
     * Removes a position deeply nested in a GeoJSON geometry coordinates array.
     * Works with MultiPoint, LineString, MultiLineString, Polygon, and MultiPolygon.
     *
     * @param featureIndex The index of the feature to update
     * @param positionIndexes An array containing the indexes of the postion to remove
     *
     * @returns A new `ImmutableFeatureCollection` with the given coordinate removed. Does not modify this `ImmutableFeatureCollection`.
     */

  }, {
    key: "removePosition",
    value: function removePosition(featureIndex, positionIndexes) {
      var geometry = this.featureCollection.features[featureIndex].geometry;

      if (geometry.type === 'Point') {
        throw Error("Can't remove a position from a Point or there'd be nothing left");
      }

      if (geometry.type === 'MultiPoint' && // only 1 point left
      geometry.coordinates.length < 2) {
        throw Error("Can't remove the last point of a MultiPoint or there'd be nothing left");
      }

      if (geometry.type === 'LineString' && // only 2 positions
      geometry.coordinates.length < 3) {
        throw Error("Can't remove position. LineString must have at least two positions");
      }

      if (geometry.type === 'Polygon' && // outer ring is a triangle
      geometry.coordinates[0].length < 5 && // trying to remove from outer ring
      positionIndexes[0] === 0) {
        throw Error("Can't remove position. Polygon's outer ring must have at least four positions");
      }

      if (geometry.type === 'MultiLineString' && // only 1 LineString left
      geometry.coordinates.length === 1 && // only 2 positions
      geometry.coordinates[0].length < 3) {
        throw Error("Can't remove position. MultiLineString must have at least two positions");
      }

      if (geometry.type === 'MultiPolygon' && // only 1 polygon left
      geometry.coordinates.length === 1 && // outer ring is a triangle
      geometry.coordinates[0][0].length < 5 && // trying to remove from first polygon
      positionIndexes[0] === 0 && // trying to remove from outer ring
      positionIndexes[1] === 0) {
        throw Error("Can't remove position. MultiPolygon's outer ring must have at least four positions");
      }

      var isPolygonal = geometry.type === 'Polygon' || geometry.type === 'MultiPolygon';

      var updatedGeometry = _objectSpread({}, geometry, {
        coordinates: immutablyRemovePosition(geometry.coordinates, positionIndexes, isPolygonal)
      }); // Handle cases where incomplete geometries need pruned (e.g. holes that were triangles)


      pruneGeometryIfNecessary(updatedGeometry);
      return this.replaceGeometry(featureIndex, updatedGeometry);
    }
    /**
     * Adds a position deeply nested in a GeoJSON geometry coordinates array.
     * Works with MultiPoint, LineString, MultiLineString, Polygon, and MultiPolygon.
     *
     * @param featureIndex The index of the feature to update
     * @param positionIndexes An array containing the indexes of the postion that will preceed the new position
     * @param positionToAdd The new position to place in the result (i.e. [lng, lat])
     *
     * @returns A new `ImmutableFeatureCollection` with the given coordinate removed. Does not modify this `ImmutableFeatureCollection`.
     */

  }, {
    key: "addPosition",
    value: function addPosition(featureIndex, positionIndexes, positionToAdd) {
      var geometry = this.featureCollection.features[featureIndex].geometry;

      if (geometry.type === 'Point') {
        throw new Error('Unable to add a position to a Point feature');
      }

      var isPolygonal = geometry.type === 'Polygon' || geometry.type === 'MultiPolygon';

      var updatedGeometry = _objectSpread({}, geometry, {
        coordinates: immutablyAddPosition(geometry.coordinates, positionIndexes, positionToAdd, isPolygonal)
      });

      return this.replaceGeometry(featureIndex, updatedGeometry);
    }
  }, {
    key: "replaceGeometry",
    value: function replaceGeometry(featureIndex, geometry) {
      var updatedFeature = _objectSpread({}, this.featureCollection.features[featureIndex], {
        geometry: geometry
      });

      var updatedFeatureCollection = _objectSpread({}, this.featureCollection, {
        features: _toConsumableArray(this.featureCollection.features.slice(0, featureIndex)).concat([updatedFeature], _toConsumableArray(this.featureCollection.features.slice(featureIndex + 1)))
      });

      return new ImmutableFeatureCollection(updatedFeatureCollection);
    }
  }, {
    key: "addFeature",
    value: function addFeature(feature) {
      var updatedFeatureCollection = _objectSpread({}, this.featureCollection, {
        features: _toConsumableArray(this.featureCollection.features).concat([feature])
      });

      return new ImmutableFeatureCollection(updatedFeatureCollection);
    }
  }]);

  return ImmutableFeatureCollection;
}();

exports.ImmutableFeatureCollection = ImmutableFeatureCollection;

function getUpdatedPosition(updatedPosition, previousPosition) {
  // This function checks if the updatedPosition is missing elevation
  // and copies it from previousPosition
  if (updatedPosition.length === 2 && previousPosition.length === 3) {
    var elevation = previousPosition[2];
    return [updatedPosition[0], updatedPosition[1], elevation];
  }

  return updatedPosition;
}

function immutablyReplacePosition(coordinates, positionIndexes, updatedPosition, isPolygonal) {
  if (!positionIndexes) {
    return coordinates;
  }

  if (positionIndexes.length === 0) {
    return getUpdatedPosition(updatedPosition, coordinates);
  }

  if (positionIndexes.length === 1) {
    var updated = _toConsumableArray(coordinates.slice(0, positionIndexes[0])).concat([getUpdatedPosition(updatedPosition, coordinates[positionIndexes[0]])], _toConsumableArray(coordinates.slice(positionIndexes[0] + 1)));

    if (isPolygonal && (positionIndexes[0] === 0 || positionIndexes[0] === coordinates.length - 1)) {
      // for polygons, the first point is repeated at the end of the array
      // so, update it on both ends of the array
      updated[0] = getUpdatedPosition(updatedPosition, coordinates[0]);
      updated[coordinates.length - 1] = getUpdatedPosition(updatedPosition, coordinates[0]);
    }

    return updated;
  } // recursively update inner array


  return _toConsumableArray(coordinates.slice(0, positionIndexes[0])).concat([immutablyReplacePosition(coordinates[positionIndexes[0]], positionIndexes.slice(1, positionIndexes.length), updatedPosition, isPolygonal)], _toConsumableArray(coordinates.slice(positionIndexes[0] + 1)));
}

function immutablyRemovePosition(coordinates, positionIndexes, isPolygonal) {
  if (!positionIndexes) {
    return coordinates;
  }

  if (positionIndexes.length === 0) {
    throw Error('Must specify the index of the position to remove');
  }

  if (positionIndexes.length === 1) {
    var updated = _toConsumableArray(coordinates.slice(0, positionIndexes[0])).concat(_toConsumableArray(coordinates.slice(positionIndexes[0] + 1)));

    if (isPolygonal && (positionIndexes[0] === 0 || positionIndexes[0] === coordinates.length - 1)) {
      // for polygons, the first point is repeated at the end of the array
      // so, if the first/last coordinate is to be removed, coordinates[1] will be the new first/last coordinate
      if (positionIndexes[0] === 0) {
        // change the last to be the same as the first
        updated[updated.length - 1] = updated[0];
      } else if (positionIndexes[0] === coordinates.length - 1) {
        // change the first to be the same as the last
        updated[0] = updated[updated.length - 1];
      }
    }

    return updated;
  } // recursively update inner array


  return _toConsumableArray(coordinates.slice(0, positionIndexes[0])).concat([immutablyRemovePosition(coordinates[positionIndexes[0]], positionIndexes.slice(1, positionIndexes.length), isPolygonal)], _toConsumableArray(coordinates.slice(positionIndexes[0] + 1)));
}

function immutablyAddPosition(coordinates, positionIndexes, positionToAdd, isPolygonal) {
  if (!positionIndexes) {
    return coordinates;
  }

  if (positionIndexes.length === 0) {
    throw Error('Must specify the index of the position to remove');
  }

  if (positionIndexes.length === 1) {
    var updated = _toConsumableArray(coordinates.slice(0, positionIndexes[0])).concat([positionToAdd], _toConsumableArray(coordinates.slice(positionIndexes[0])));

    return updated;
  } // recursively update inner array


  return _toConsumableArray(coordinates.slice(0, positionIndexes[0])).concat([immutablyAddPosition(coordinates[positionIndexes[0]], positionIndexes.slice(1, positionIndexes.length), positionToAdd, isPolygonal)], _toConsumableArray(coordinates.slice(positionIndexes[0] + 1)));
}

function pruneGeometryIfNecessary(geometry) {
  switch (geometry.type) {
    case 'Polygon':
      prunePolygonIfNecessary(geometry);
      break;

    case 'MultiLineString':
      pruneMultiLineStringIfNecessary(geometry);
      break;

    case 'MultiPolygon':
      pruneMultiPolygonIfNecessary(geometry);
      break;

    default:
      // Not downgradable
      break;
  }
}

function prunePolygonIfNecessary(geometry) {
  var polygon = geometry.coordinates; // If any hole is no longer a polygon, remove the hole entirely

  for (var holeIndex = 1; holeIndex < polygon.length; holeIndex++) {
    if (removeHoleIfNecessary(polygon, holeIndex)) {
      // It was removed, so keep the index the same
      holeIndex--;
    }
  }
}

function pruneMultiLineStringIfNecessary(geometry) {
  for (var lineStringIndex = 0; lineStringIndex < geometry.coordinates.length; lineStringIndex++) {
    var lineString = geometry.coordinates[lineStringIndex];

    if (lineString.length === 1) {
      // Only a single position left on this LineString, so remove it (can't have Point in MultiLineString)
      geometry.coordinates.splice(lineStringIndex, 1); // Keep the index the same

      lineStringIndex--;
    }
  }
}

function pruneMultiPolygonIfNecessary(geometry) {
  for (var polygonIndex = 0; polygonIndex < geometry.coordinates.length; polygonIndex++) {
    var polygon = geometry.coordinates[polygonIndex];
    var outerRing = polygon[0]; // If the outer ring is no longer a polygon, remove the whole polygon

    if (outerRing.length <= 3) {
      geometry.coordinates.splice(polygonIndex, 1); // It was removed, so keep the index the same

      polygonIndex--;
    }

    for (var holeIndex = 1; holeIndex < polygon.length; holeIndex++) {
      if (removeHoleIfNecessary(polygon, holeIndex)) {
        // It was removed, so keep the index the same
        holeIndex--;
      }
    }
  }
}

function removeHoleIfNecessary(polygon, holeIndex) {
  var hole = polygon[holeIndex];

  if (hole.length <= 3) {
    polygon.splice(holeIndex, 1);
    return true;
  }

  return false;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbW11dGFibGUtZmVhdHVyZS1jb2xsZWN0aW9uLmpzIl0sIm5hbWVzIjpbIkltbXV0YWJsZUZlYXR1cmVDb2xsZWN0aW9uIiwiZmVhdHVyZUNvbGxlY3Rpb24iLCJmZWF0dXJlSW5kZXgiLCJwb3NpdGlvbkluZGV4ZXMiLCJ1cGRhdGVkUG9zaXRpb24iLCJnZW9tZXRyeSIsImZlYXR1cmVzIiwiaXNQb2x5Z29uYWwiLCJ0eXBlIiwidXBkYXRlZEdlb21ldHJ5IiwiY29vcmRpbmF0ZXMiLCJpbW11dGFibHlSZXBsYWNlUG9zaXRpb24iLCJyZXBsYWNlR2VvbWV0cnkiLCJFcnJvciIsImxlbmd0aCIsImltbXV0YWJseVJlbW92ZVBvc2l0aW9uIiwicHJ1bmVHZW9tZXRyeUlmTmVjZXNzYXJ5IiwicG9zaXRpb25Ub0FkZCIsImltbXV0YWJseUFkZFBvc2l0aW9uIiwidXBkYXRlZEZlYXR1cmUiLCJ1cGRhdGVkRmVhdHVyZUNvbGxlY3Rpb24iLCJzbGljZSIsImZlYXR1cmUiLCJnZXRVcGRhdGVkUG9zaXRpb24iLCJwcmV2aW91c1Bvc2l0aW9uIiwiZWxldmF0aW9uIiwidXBkYXRlZCIsInBydW5lUG9seWdvbklmTmVjZXNzYXJ5IiwicHJ1bmVNdWx0aUxpbmVTdHJpbmdJZk5lY2Vzc2FyeSIsInBydW5lTXVsdGlQb2x5Z29uSWZOZWNlc3NhcnkiLCJwb2x5Z29uIiwiaG9sZUluZGV4IiwicmVtb3ZlSG9sZUlmTmVjZXNzYXJ5IiwibGluZVN0cmluZ0luZGV4IiwibGluZVN0cmluZyIsInNwbGljZSIsInBvbHlnb25JbmRleCIsIm91dGVyUmluZyIsImhvbGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFhYUEsMEI7OztBQUdYLHNDQUFZQyxpQkFBWixFQUFrRDtBQUFBOztBQUFBOztBQUNoRCxTQUFLQSxpQkFBTCxHQUF5QkEsaUJBQXpCO0FBQ0Q7Ozs7Z0NBRVc7QUFDVixhQUFPLEtBQUtBLGlCQUFaO0FBQ0Q7QUFF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QjtBQUNBLFdBQU8sSUFBUDtBQUNEOztBQUNELFNBQU8sS0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcblxuaW1wb3J0IHR5cGUge1xuICBGZWF0dXJlLFxuICBGZWF0dXJlQ29sbGVjdGlvbixcbiAgR2VvbWV0cnksXG4gIFBvbHlnb24sXG4gIE11bHRpTGluZVN0cmluZyxcbiAgTXVsdGlQb2x5Z29uLFxuICBQb3NpdGlvbixcbiAgUG9seWdvbkNvb3JkaW5hdGVzXG59IGZyb20gJy4vZ2VvanNvbi10eXBlcy5qcyc7XG5cbmV4cG9ydCBjbGFzcyBJbW11dGFibGVGZWF0dXJlQ29sbGVjdGlvbiB7XG4gIGZlYXR1cmVDb2xsZWN0aW9uOiBGZWF0dXJlQ29sbGVjdGlvbjtcblxuICBjb25zdHJ1Y3RvcihmZWF0dXJlQ29sbGVjdGlvbjogRmVhdHVyZUNvbGxlY3Rpb24pIHtcbiAgICB0aGlzLmZlYXR1cmVDb2xsZWN0aW9uID0gZmVhdHVyZUNvbGxlY3Rpb247XG4gIH1cblxuICBnZXRPYmplY3QoKSB7XG4gICAgcmV0dXJuIHRoaXMuZmVhdHVyZUNvbGxlY3Rpb247XG4gIH1cblxuICAvKipcbiAgICogUmVwbGFjZXMgdGhlIHBvc2l0aW9uIGRlZXBseSBuZXN0ZWQgd2l0aGluZyB0aGUgZ2l2ZW4gZmVhdHVyZSdzIGdlb21ldHJ5LlxuICAgKiBXb3JrcyB3aXRoIFBvaW50LCBNdWx0aVBvaW50LCBMaW5lU3RyaW5nLCBNdWx0aUxpbmVTdHJpbmcsIFBvbHlnb24sIGFuZCBNdWx0aVBvbHlnb24uXG4gICAqXG4gICAqIEBwYXJhbSBmZWF0dXJlSW5kZXggVGhlIGluZGV4IG9mIHRoZSBmZWF0dXJlIHRvIHVwZGF0ZVxuICAgKiBAcGFyYW0gcG9zaXRpb25JbmRleGVzIEFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIGluZGV4ZXMgb2YgdGhlIHBvc2l0aW9uIHRvIHJlcGxhY2VcbiAgICogQHBhcmFtIHVwZGF0ZWRQb3NpdGlvbiBUaGUgdXBkYXRlZCBwb3NpdGlvbiB0byBwbGFjZSBpbiB0aGUgcmVzdWx0IChpLmUuIFtsbmcsIGxhdF0pXG4gICAqXG4gICAqIEByZXR1cm5zIEEgbmV3IGBJbW11dGFibGVGZWF0dXJlQ29sbGVjdGlvbmAgd2l0aCB0aGUgZ2l2ZW4gcG9zaXRpb24gcmVwbGFjZWQuIERvZXMgbm90IG1vZGlmeSB0aGlzIGBJbW11dGFibGVGZWF0dXJlQ29sbGVjdGlvbmAuXG4gICAqL1xuICByZXBsYWNlUG9zaXRpb24oXG4gICAgZmVhdHVyZUluZGV4OiBudW1iZXIsXG4gICAgcG9zaXRpb25JbmRleGVzOiBudW1iZXJbXSxcbiAgICB1cGRhdGVkUG9zaXRpb246IFBvc2l0aW9uXG4gICk6IEltbXV0YWJsZUZlYXR1cmVDb2xsZWN0aW9uIHtcbiAgICBjb25zdCBnZW9tZXRyeSA9IHRoaXMuZmVhdHVyZUNvbGxlY3Rpb24uZmVhdHVyZXNbZmVhdHVyZUluZGV4XS5nZW9tZXRyeTtcblxuICAgIGNvbnN0IGlzUG9seWdvbmFsID0gZ2VvbWV0cnkudHlwZSA9PT0gJ1BvbHlnb24nIHx8IGdlb21ldHJ5LnR5cGUgPT09ICdNdWx0aVBvbHlnb24nO1xuICAgIGNvbnN0IHVwZGF0ZWRHZW9tZXRyeTogYW55ID0ge1xuICAgICAgLi4uZ2VvbWV0cnksXG4gICAgICBjb29yZGluYXRlczogaW1tdXRhYmx5UmVwbGFjZVBvc2l0aW9uKFxuICAgICAgICBnZW9tZXRyeS5jb29yZGluYXRlcyxcbiAgICAgICAgcG9zaXRpb25JbmRleGVzLFxuICAgICAgICB1cGRhdGVkUG9zaXRpb24sXG4gICAgICAgIGlzUG9seWdvbmFsXG4gICAgICApXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLnJlcGxhY2VHZW9tZXRyeShmZWF0dXJlSW5kZXgsIHVwZGF0ZWRHZW9tZXRyeSk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhIHBvc2l0aW9uIGRlZXBseSBuZXN0ZWQgaW4gYSBHZW9KU09OIGdlb21ldHJ5IGNvb3JkaW5hdGVzIGFycmF5LlxuICAgKiBXb3JrcyB3aXRoIE11bHRpUG9pbnQsIExpbmVTdHJpbmcsIE11bHRpTGluZVN0cmluZywgUG9seWdvbiwgYW5kIE11bHRpUG9seWdvbi5cbiAgICpcbiAgICogQHBhcmFtIGZlYXR1cmVJbmRleCBUaGUgaW5kZXggb2YgdGhlIGZlYXR1cmUgdG8gdXBkYXRlXG4gICAqIEBwYXJhbSBwb3NpdGlvbkluZGV4ZXMgQW4gYXJyYXkgY29udGFpbmluZyB0aGUgaW5kZXhlcyBvZiB0aGUgcG9zdGlvbiB0byByZW1vdmVcbiAgICpcbiAgICogQHJldHVybnMgQSBuZXcgYEltbXV0YWJsZUZlYXR1cmVDb2xsZWN0aW9uYCB3aXRoIHRoZSBnaXZlbiBjb29yZGluYXRlIHJlbW92ZWQuIERvZXMgbm90IG1vZGlmeSB0aGlzIGBJbW11dGFibGVGZWF0dXJlQ29sbGVjdGlvbmAuXG4gICAqL1xuICByZW1vdmVQb3NpdGlvbihmZWF0dXJlSW5kZXg6IG51bWJlciwgcG9zaXRpb25JbmRleGVzOiBudW1iZXJbXSk6IEltbXV0YWJsZUZlYXR1cmVDb2xsZWN0aW9uIHtcbiAgICBjb25zdCBnZW9tZXRyeSA9IHRoaXMuZmVhdHVyZUNvbGxlY3Rpb24uZmVhdHVyZXNbZmVhdHVyZUluZGV4XS5nZW9tZXRyeTtcblxuICAgIGlmIChnZW9tZXRyeS50eXBlID09PSAnUG9pbnQnKSB7XG4gICAgICB0aHJvdyBFcnJvcihgQ2FuJ3QgcmVtb3ZlIGEgcG9zaXRpb24gZnJvbSBhIFBvaW50IG9yIHRoZXJlJ2QgYmUgbm90aGluZyBsZWZ0YCk7XG4gICAgfVxuICAgIGlmIChcbiAgICAgIGdlb21ldHJ5LnR5cGUgPT09ICdNdWx0aVBvaW50JyAmJlxuICAgICAgLy8gb25seSAxIHBvaW50IGxlZnRcbiAgICAgIGdlb21ldHJ5LmNvb3JkaW5hdGVzLmxlbmd0aCA8IDJcbiAgICApIHtcbiAgICAgIHRocm93IEVycm9yKGBDYW4ndCByZW1vdmUgdGhlIGxhc3QgcG9pbnQgb2YgYSBNdWx0aVBvaW50IG9yIHRoZXJlJ2QgYmUgbm90aGluZyBsZWZ0YCk7XG4gICAgfVxuICAgIGlmIChcbiAgICAgIGdlb21ldHJ5LnR5cGUgPT09ICdMaW5lU3RyaW5nJyAmJlxuICAgICAgLy8gb25seSAyIHBvc2l0aW9uc1xuICAgICAgZ2VvbWV0cnkuY29vcmRpbmF0ZXMubGVuZ3RoIDwgM1xuICAgICkge1xuICAgICAgdGhyb3cgRXJyb3IoYENhbid0IHJlbW92ZSBwb3NpdGlvbi4gTGluZVN0cmluZyBtdXN0IGhhdmUgYXQgbGVhc3QgdHdvIHBvc2l0aW9uc2ApO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICBnZW9tZXRyeS50eXBlID09PSAnUG9seWdvbicgJiZcbiAgICAgIC8vIG91dGVyIHJpbmcgaXMgYSB0cmlhbmdsZVxuICAgICAgZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMF0ubGVuZ3RoIDwgNSAmJlxuICAgICAgLy8gdHJ5aW5nIHRvIHJlbW92ZSBmcm9tIG91dGVyIHJpbmdcbiAgICAgIHBvc2l0aW9uSW5kZXhlc1swXSA9PT0gMFxuICAgICkge1xuICAgICAgdGhyb3cgRXJyb3IoYENhbid0IHJlbW92ZSBwb3NpdGlvbi4gUG9seWdvbidzIG91dGVyIHJpbmcgbXVzdCBoYXZlIGF0IGxlYXN0IGZvdXIgcG9zaXRpb25zYCk7XG4gICAgfVxuICAgIGlmIChcbiAgICAgIGdlb21ldHJ5LnR5cGUgPT09ICdNdWx0aUxpbmVTdHJpbmcnICYmXG4gICAgICAvLyBvbmx5IDEgTGluZVN0cmluZyBsZWZ0XG4gICAgICBnZW9tZXRyeS5jb29yZGluYXRlcy5sZW5ndGggPT09IDEgJiZcbiAgICAgIC8vIG9ubHkgMiBwb3NpdGlvbnNcbiAgICAgIGdlb21ldHJ5LmNvb3JkaW5hdGVzWzBdLmxlbmd0aCA8IDNcbiAgICApIHtcbiAgICAgIHRocm93IEVycm9yKGBDYW4ndCByZW1vdmUgcG9zaXRpb24uIE11bHRpTGluZVN0cmluZyBtdXN0IGhhdmUgYXQgbGVhc3QgdHdvIHBvc2l0aW9uc2ApO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICBnZW9tZXRyeS50eXBlID09PSAnTXVsdGlQb2x5Z29uJyAmJlxuICAgICAgLy8gb25seSAxIHBvbHlnb24gbGVmdFxuICAgICAgZ2VvbWV0cnkuY29vcmRpbmF0ZXMubGVuZ3RoID09PSAxICYmXG4gICAgICAvLyBvdXRlciByaW5nIGlzIGEgdHJpYW5nbGVcbiAgICAgIGdlb21ldHJ5LmNvb3JkaW5hdGVzWzBdWzBdLmxlbmd0aCA8IDUgJiZcbiAgICAgIC8vIHRyeWluZyB0byByZW1vdmUgZnJvbSBmaXJzdCBwb2x5Z29uXG4gICAgICBwb3NpdGlvbkluZGV4ZXNbMF0gPT09IDAgJiZcbiAgICAgIC8vIHRyeWluZyB0byByZW1vdmUgZnJvbSBvdXRlciByaW5nXG4gICAgICBwb3NpdGlvbkluZGV4ZXNbMV0gPT09IDBcbiAgICApIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICBgQ2FuJ3QgcmVtb3ZlIHBvc2l0aW9uLiBNdWx0aVBvbHlnb24ncyBvdXRlciByaW5nIG11c3QgaGF2ZSBhdCBsZWFzdCBmb3VyIHBvc2l0aW9uc2BcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgaXNQb2x5Z29uYWwgPSBnZW9tZXRyeS50eXBlID09PSAnUG9seWdvbicgfHwgZ2VvbWV0cnkudHlwZSA9PT0gJ011bHRpUG9seWdvbic7XG4gICAgY29uc3QgdXBkYXRlZEdlb21ldHJ5OiBhbnkgPSB7XG4gICAgICAuLi5nZW9tZXRyeSxcbiAgICAgIGNvb3JkaW5hdGVzOiBpbW11dGFibHlSZW1vdmVQb3NpdGlvbihnZW9tZXRyeS5jb29yZGluYXRlcywgcG9zaXRpb25JbmRleGVzLCBpc1BvbHlnb25hbClcbiAgICB9O1xuXG4gICAgLy8gSGFuZGxlIGNhc2VzIHdoZXJlIGluY29tcGxldGUgZ2VvbWV0cmllcyBuZWVkIHBydW5lZCAoZS5nLiBob2xlcyB0aGF0IHdlcmUgdHJpYW5nbGVzKVxuICAgIHBydW5lR2VvbWV0cnlJZk5lY2Vzc2FyeSh1cGRhdGVkR2VvbWV0cnkpO1xuXG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZUdlb21ldHJ5KGZlYXR1cmVJbmRleCwgdXBkYXRlZEdlb21ldHJ5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgcG9zaXRpb24gZGVlcGx5IG5lc3RlZCBpbiBhIEdlb0pTT04gZ2VvbWV0cnkgY29vcmRpbmF0ZXMgYXJyYXkuXG4gICAqIFdvcmtzIHdpdGggTXVsdGlQb2ludCwgTGluZVN0cmluZywgTXVsdGlMaW5lU3RyaW5nLCBQb2x5Z29uLCBhbmQgTXVsdGlQb2x5Z29uLlxuICAgKlxuICAgKiBAcGFyYW0gZmVhdHVyZUluZGV4IFRoZSBpbmRleCBvZiB0aGUgZmVhdHVyZSB0byB1cGRhdGVcbiAgICogQHBhcmFtIHBvc2l0aW9uSW5kZXhlcyBBbiBhcnJheSBjb250YWluaW5nIHRoZSBpbmRleGVzIG9mIHRoZSBwb3N0aW9uIHRoYXQgd2lsbCBwcmVjZWVkIHRoZSBuZXcgcG9zaXRpb25cbiAgICogQHBhcmFtIHBvc2l0aW9uVG9BZGQgVGhlIG5ldyBwb3NpdGlvbiB0byBwbGFjZSBpbiB0aGUgcmVzdWx0IChpLmUuIFtsbmcsIGxhdF0pXG4gICAqXG4gICAqIEByZXR1cm5zIEEgbmV3IGBJbW11dGFibGVGZWF0dXJlQ29sbGVjdGlvbmAgd2l0aCB0aGUgZ2l2ZW4gY29vcmRpbmF0ZSByZW1vdmVkLiBEb2VzIG5vdCBtb2RpZnkgdGhpcyBgSW1tdXRhYmxlRmVhdHVyZUNvbGxlY3Rpb25gLlxuICAgKi9cbiAgYWRkUG9zaXRpb24oXG4gICAgZmVhdHVyZUluZGV4OiBudW1iZXIsXG4gICAgcG9zaXRpb25JbmRleGVzOiBudW1iZXJbXSxcbiAgICBwb3NpdGlvblRvQWRkOiBQb3NpdGlvblxuICApOiBJbW11dGFibGVGZWF0dXJlQ29sbGVjdGlvbiB7XG4gICAgY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmZlYXR1cmVDb2xsZWN0aW9uLmZlYXR1cmVzW2ZlYXR1cmVJbmRleF0uZ2VvbWV0cnk7XG5cbiAgICBpZiAoZ2VvbWV0cnkudHlwZSA9PT0gJ1BvaW50Jykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gYWRkIGEgcG9zaXRpb24gdG8gYSBQb2ludCBmZWF0dXJlJyk7XG4gICAgfVxuXG4gICAgY29uc3QgaXNQb2x5Z29uYWwgPSBnZW9tZXRyeS50eXBlID09PSAnUG9seWdvbicgfHwgZ2VvbWV0cnkudHlwZSA9PT0gJ011bHRpUG9seWdvbic7XG4gICAgY29uc3QgdXBkYXRlZEdlb21ldHJ5OiBhbnkgPSB7XG4gICAgICAuLi5nZW9tZXRyeSxcbiAgICAgIGNvb3JkaW5hdGVzOiBpbW11dGFibHlBZGRQb3NpdGlvbihcbiAgICAgICAgZ2VvbWV0cnkuY29vcmRpbmF0ZXMsXG4gICAgICAgIHBvc2l0aW9uSW5kZXhlcyxcbiAgICAgICAgcG9zaXRpb25Ub0FkZCxcbiAgICAgICAgaXNQb2x5Z29uYWxcbiAgICAgIClcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZUdlb21ldHJ5KGZlYXR1cmVJbmRleCwgdXBkYXRlZEdlb21ldHJ5KTtcbiAgfVxuXG4gIHJlcGxhY2VHZW9tZXRyeShmZWF0dXJlSW5kZXg6IG51bWJlciwgZ2VvbWV0cnk6IEdlb21ldHJ5KTogSW1tdXRhYmxlRmVhdHVyZUNvbGxlY3Rpb24ge1xuICAgIGNvbnN0IHVwZGF0ZWRGZWF0dXJlOiBhbnkgPSB7XG4gICAgICAuLi50aGlzLmZlYXR1cmVDb2xsZWN0aW9uLmZlYXR1cmVzW2ZlYXR1cmVJbmRleF0sXG4gICAgICBnZW9tZXRyeVxuICAgIH07XG5cbiAgICBjb25zdCB1cGRhdGVkRmVhdHVyZUNvbGxlY3Rpb24gPSB7XG4gICAgICAuLi50aGlzLmZlYXR1cmVDb2xsZWN0aW9uLFxuICAgICAgZmVhdHVyZXM6IFtcbiAgICAgICAgLi4udGhpcy5mZWF0dXJlQ29sbGVjdGlvbi5mZWF0dXJlcy5zbGljZSgwLCBmZWF0dXJlSW5kZXgpLFxuICAgICAgICB1cGRhdGVkRmVhdHVyZSxcbiAgICAgICAgLi4udGhpcy5mZWF0dXJlQ29sbGVjdGlvbi5mZWF0dXJlcy5zbGljZShmZWF0dXJlSW5kZXggKyAxKVxuICAgICAgXVxuICAgIH07XG5cbiAgICByZXR1cm4gbmV3IEltbXV0YWJsZUZlYXR1cmVDb2xsZWN0aW9uKHVwZGF0ZWRGZWF0dXJlQ29sbGVjdGlvbik7XG4gIH1cblxuICBhZGRGZWF0dXJlKGZlYXR1cmU6IEZlYXR1cmUpOiBJbW11dGFibGVGZWF0dXJlQ29sbGVjdGlvbiB7XG4gICAgY29uc3QgdXBkYXRlZEZlYXR1cmVDb2xsZWN0aW9uID0ge1xuICAgICAgLi4udGhpcy5mZWF0dXJlQ29sbGVjdGlvbixcbiAgICAgIGZlYXR1cmVzOiBbLi4udGhpcy5mZWF0dXJlQ29sbGVjdGlvbi5mZWF0dXJlcywgZmVhdHVyZV1cbiAgICB9O1xuXG4gICAgcmV0dXJuIG5ldyBJbW11dGFibGVGZWF0dXJlQ29sbGVjdGlvbih1cGRhdGVkRmVhdHVyZUNvbGxlY3Rpb24pO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldFVwZGF0ZWRQb3NpdGlvbih1cGRhdGVkUG9zaXRpb246IFBvc2l0aW9uLCBwcmV2aW91c1Bvc2l0aW9uOiBQb3NpdGlvbik6IFBvc2l0aW9uIHtcbiAgLy8gVGhpcyBmdW5jdGlvbiBjaGVja3MgaWYgdGhlIHVwZGF0ZWRQb3NpdGlvbiBpcyBtaXNzaW5nIGVsZXZhdGlvblxuICAvLyBhbmQgY29waWVzIGl0IGZyb20gcHJldmlvdXNQb3NpdGlvblxuICBpZiAodXBkYXRlZFBvc2l0aW9uLmxlbmd0aCA9PT0gMiAmJiBwcmV2aW91c1Bvc2l0aW9uLmxlbmd0aCA9PT0gMykge1xuICAgIGNvbnN0IGVsZXZhdGlvbiA9IChwcmV2aW91c1Bvc2l0aW9uOiBhbnkpWzJdO1xuICAgIHJldHVybiBbdXBkYXRlZFBvc2l0aW9uWzBdLCB1cGRhdGVkUG9zaXRpb25bMV0sIGVsZXZhdGlvbl07XG4gIH1cblxuICByZXR1cm4gdXBkYXRlZFBvc2l0aW9uO1xufVxuXG5mdW5jdGlvbiBpbW11dGFibHlSZXBsYWNlUG9zaXRpb24oXG4gIGNvb3JkaW5hdGVzOiBhbnksXG4gIHBvc2l0aW9uSW5kZXhlczogbnVtYmVyW10sXG4gIHVwZGF0ZWRQb3NpdGlvbjogUG9zaXRpb24sXG4gIGlzUG9seWdvbmFsOiBib29sZWFuXG4pOiBhbnkge1xuICBpZiAoIXBvc2l0aW9uSW5kZXhlcykge1xuICAgIHJldHVybiBjb29yZGluYXRlcztcbiAgfVxuICBpZiAocG9zaXRpb25JbmRleGVzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBnZXRVcGRhdGVkUG9zaXRpb24odXBkYXRlZFBvc2l0aW9uLCBjb29yZGluYXRlcyk7XG4gIH1cbiAgaWYgKHBvc2l0aW9uSW5kZXhlcy5sZW5ndGggPT09IDEpIHtcbiAgICBjb25zdCB1cGRhdGVkID0gW1xuICAgICAgLi4uY29vcmRpbmF0ZXMuc2xpY2UoMCwgcG9zaXRpb25JbmRleGVzWzBdKSxcbiAgICAgIGdldFVwZGF0ZWRQb3NpdGlvbih1cGRhdGVkUG9zaXRpb24sIGNvb3JkaW5hdGVzW3Bvc2l0aW9uSW5kZXhlc1swXV0pLFxuICAgICAgLi4uY29vcmRpbmF0ZXMuc2xpY2UocG9zaXRpb25JbmRleGVzWzBdICsgMSlcbiAgICBdO1xuXG4gICAgaWYgKFxuICAgICAgaXNQb2x5Z29uYWwgJiZcbiAgICAgIChwb3NpdGlvbkluZGV4ZXNbMF0gPT09IDAgfHwgcG9zaXRpb25JbmRleGVzWzBdID09PSBjb29yZGluYXRlcy5sZW5ndGggLSAxKVxuICAgICkge1xuICAgICAgLy8gZm9yIHBvbHlnb25zLCB0aGUgZmlyc3QgcG9pbnQgaXMgcmVwZWF0ZWQgYXQgdGhlIGVuZCBvZiB0aGUgYXJyYXlcbiAgICAgIC8vIHNvLCB1cGRhdGUgaXQgb24gYm90aCBlbmRzIG9mIHRoZSBhcnJheVxuICAgICAgdXBkYXRlZFswXSA9IGdldFVwZGF0ZWRQb3NpdGlvbih1cGRhdGVkUG9zaXRpb24sIGNvb3JkaW5hdGVzWzBdKTtcbiAgICAgIHVwZGF0ZWRbY29vcmRpbmF0ZXMubGVuZ3RoIC0gMV0gPSBnZXRVcGRhdGVkUG9zaXRpb24odXBkYXRlZFBvc2l0aW9uLCBjb29yZGluYXRlc1swXSk7XG4gICAgfVxuICAgIHJldHVybiB1cGRhdGVkO1xuICB9XG5cbiAgLy8gcmVjdXJzaXZlbHkgdXBkYXRlIGlubmVyIGFycmF5XG4gIHJldHVybiBbXG4gICAgLi4uY29vcmRpbmF0ZXMuc2xpY2UoMCwgcG9zaXRpb25JbmRleGVzWzBdKSxcbiAgICBpbW11dGFibHlSZXBsYWNlUG9zaXRpb24oXG4gICAgICBjb29yZGluYXRlc1twb3NpdGlvbkluZGV4ZXNbMF1dLFxuICAgICAgcG9zaXRpb25JbmRleGVzLnNsaWNlKDEsIHBvc2l0aW9uSW5kZXhlcy5sZW5ndGgpLFxuICAgICAgdXBkYXRlZFBvc2l0aW9uLFxuICAgICAgaXNQb2x5Z29uYWxcbiAgICApLFxuICAgIC4uLmNvb3JkaW5hdGVzLnNsaWNlKHBvc2l0aW9uSW5kZXhlc1swXSArIDEpXG4gIF07XG59XG5cbmZ1bmN0aW9uIGltbXV0YWJseVJlbW92ZVBvc2l0aW9uKFxuICBjb29yZGluYXRlczogYW55LFxuICBwb3NpdGlvbkluZGV4ZXM6IG51bWJlcltdLFxuICBpc1BvbHlnb25hbDogYm9vbGVhblxuKTogYW55IHtcbiAgaWYgKCFwb3NpdGlvbkluZGV4ZXMpIHtcbiAgICByZXR1cm4gY29vcmRpbmF0ZXM7XG4gIH1cbiAgaWYgKHBvc2l0aW9uSW5kZXhlcy5sZW5ndGggPT09IDApIHtcbiAgICB0aHJvdyBFcnJvcignTXVzdCBzcGVjaWZ5IHRoZSBpbmRleCBvZiB0aGUgcG9zaXRpb24gdG8gcmVtb3ZlJyk7XG4gIH1cbiAgaWYgKHBvc2l0aW9uSW5kZXhlcy5sZW5ndGggPT09IDEpIHtcbiAgICBjb25zdCB1cGRhdGVkID0gW1xuICAgICAgLi4uY29vcmRpbmF0ZXMuc2xpY2UoMCwgcG9zaXRpb25JbmRleGVzWzBdKSxcbiAgICAgIC4uLmNvb3JkaW5hdGVzLnNsaWNlKHBvc2l0aW9uSW5kZXhlc1swXSArIDEpXG4gICAgXTtcblxuICAgIGlmIChcbiAgICAgIGlzUG9seWdvbmFsICYmXG4gICAgICAocG9zaXRpb25JbmRleGVzWzBdID09PSAwIHx8IHBvc2l0aW9uSW5kZXhlc1swXSA9PT0gY29vcmRpbmF0ZXMubGVuZ3RoIC0gMSlcbiAgICApIHtcbiAgICAgIC8vIGZvciBwb2x5Z29ucywgdGhlIGZpcnN0IHBvaW50IGlzIHJlcGVhdGVkIGF0IHRoZSBlbmQgb2YgdGhlIGFycmF5XG4gICAgICAvLyBzbywgaWYgdGhlIGZpcnN0L2xhc3QgY29vcmRpbmF0ZSBpcyB0byBiZSByZW1vdmVkLCBjb29yZGluYXRlc1sxXSB3aWxsIGJlIHRoZSBuZXcgZmlyc3QvbGFzdCBjb29yZGluYXRlXG4gICAgICBpZiAocG9zaXRpb25JbmRleGVzWzBdID09PSAwKSB7XG4gICAgICAgIC8vIGNoYW5nZSB0aGUgbGFzdCB0byBiZSB0aGUgc2FtZSBhcyB0aGUgZmlyc3RcbiAgICAgICAgdXBkYXRlZFt1cGRhdGVkLmxlbmd0aCAtIDFdID0gdXBkYXRlZFswXTtcbiAgICAgIH0gZWxzZSBpZiAocG9zaXRpb25JbmRleGVzWzBdID09PSBjb29yZGluYXRlcy5sZW5ndGggLSAxKSB7XG4gICAgICAgIC8vIGNoYW5nZSB0aGUgZmlyc3QgdG8gYmUgdGhlIHNhbWUgYXMgdGhlIGxhc3RcbiAgICAgICAgdXBkYXRlZFswXSA9IHVwZGF0ZWRbdXBkYXRlZC5sZW5ndGggLSAxXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHVwZGF0ZWQ7XG4gIH1cblxuICAvLyByZWN1cnNpdmVseSB1cGRhdGUgaW5uZXIgYXJyYXlcbiAgcmV0dXJuIFtcbiAgICAuLi5jb29yZGluYXRlcy5zbGljZSgwLCBwb3NpdGlvbkluZGV4ZXNbMF0pLFxuICAgIGltbXV0YWJseVJlbW92ZVBvc2l0aW9uKFxuICAgICAgY29vcmRpbmF0ZXNbcG9zaXRpb25JbmRleGVzWzBdXSxcbiAgICAgIHBvc2l0aW9uSW5kZXhlcy5zbGljZSgxLCBwb3NpdGlvbkluZGV4ZXMubGVuZ3RoKSxcbiAgICAgIGlzUG9seWdvbmFsXG4gICAgKSxcbiAgICAuLi5jb29yZGluYXRlcy5zbGljZShwb3NpdGlvbkluZGV4ZXNbMF0gKyAxKVxuICBdO1xufVxuXG5mdW5jdGlvbiBpbW11dGFibHlBZGRQb3NpdGlvbihcbiAgY29vcmRpbmF0ZXM6IGFueSxcbiAgcG9zaXRpb25JbmRleGVzOiBudW1iZXJbXSxcbiAgcG9zaXRpb25Ub0FkZDogUG9zaXRpb24sXG4gIGlzUG9seWdvbmFsOiBib29sZWFuXG4pOiBhbnkge1xuICBpZiAoIXBvc2l0aW9uSW5kZXhlcykge1xuICAgIHJldHVybiBjb29yZGluYXRlcztcbiAgfVxuICBpZiAocG9zaXRpb25JbmRleGVzLmxlbmd0aCA9PT0gMCkge1xuICAgIHRocm93IEVycm9yKCdNdXN0IHNwZWNpZnkgdGhlIGluZGV4IG9mIHRoZSBwb3NpdGlvbiB0byByZW1vdmUnKTtcbiAgfVxuICBpZiAocG9zaXRpb25JbmRleGVzLmxlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IHVwZGF0ZWQgPSBbXG4gICAgICAuLi5jb29yZGluYXRlcy5zbGljZSgwLCBwb3NpdGlvbkluZGV4ZXNbMF0pLFxuICAgICAgcG9zaXRpb25Ub0FkZCxcbiAgICAgIC4uLmNvb3JkaW5hdGVzLnNsaWNlKHBvc2l0aW9uSW5kZXhlc1swXSlcbiAgICBdO1xuICAgIHJldHVybiB1cGRhdGVkO1xuICB9XG5cbiAgLy8gcmVjdXJzaXZlbHkgdXBkYXRlIGlubmVyIGFycmF5XG4gIHJldHVybiBbXG4gICAgLi4uY29vcmRpbmF0ZXMuc2xpY2UoMCwgcG9zaXRpb25JbmRleGVzWzBdKSxcbiAgICBpbW11dGFibHlBZGRQb3NpdGlvbihcbiAgICAgIGNvb3JkaW5hdGVzW3Bvc2l0aW9uSW5kZXhlc1swXV0sXG4gICAgICBwb3NpdGlvbkluZGV4ZXMuc2xpY2UoMSwgcG9zaXRpb25JbmRleGVzLmxlbmd0aCksXG4gICAgICBwb3NpdGlvblRvQWRkLFxuICAgICAgaXNQb2x5Z29uYWxcbiAgICApLFxuICAgIC4uLmNvb3JkaW5hdGVzLnNsaWNlKHBvc2l0aW9uSW5kZXhlc1swXSArIDEpXG4gIF07XG59XG5cbmZ1bmN0aW9uIHBydW5lR2VvbWV0cnlJZk5lY2Vzc2FyeShnZW9tZXRyeTogR2VvbWV0cnkpIHtcbiAgc3dpdGNoIChnZW9tZXRyeS50eXBlKSB7XG4gICAgY2FzZSAnUG9seWdvbic6XG4gICAgICBwcnVuZVBvbHlnb25JZk5lY2Vzc2FyeShnZW9tZXRyeSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdNdWx0aUxpbmVTdHJpbmcnOlxuICAgICAgcHJ1bmVNdWx0aUxpbmVTdHJpbmdJZk5lY2Vzc2FyeShnZW9tZXRyeSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdNdWx0aVBvbHlnb24nOlxuICAgICAgcHJ1bmVNdWx0aVBvbHlnb25JZk5lY2Vzc2FyeShnZW9tZXRyeSk7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgLy8gTm90IGRvd25ncmFkYWJsZVxuICAgICAgYnJlYWs7XG4gIH1cbn1cblxuZnVuY3Rpb24gcHJ1bmVQb2x5Z29uSWZOZWNlc3NhcnkoZ2VvbWV0cnk6IFBvbHlnb24pIHtcbiAgY29uc3QgcG9seWdvbiA9IGdlb21ldHJ5LmNvb3JkaW5hdGVzO1xuXG4gIC8vIElmIGFueSBob2xlIGlzIG5vIGxvbmdlciBhIHBvbHlnb24sIHJlbW92ZSB0aGUgaG9sZSBlbnRpcmVseVxuICBmb3IgKGxldCBob2xlSW5kZXggPSAxOyBob2xlSW5kZXggPCBwb2x5Z29uLmxlbmd0aDsgaG9sZUluZGV4KyspIHtcbiAgICBpZiAocmVtb3ZlSG9sZUlmTmVjZXNzYXJ5KHBvbHlnb24sIGhvbGVJbmRleCkpIHtcbiAgICAgIC8vIEl0IHdhcyByZW1vdmVkLCBzbyBrZWVwIHRoZSBpbmRleCB0aGUgc2FtZVxuICAgICAgaG9sZUluZGV4LS07XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHBydW5lTXVsdGlMaW5lU3RyaW5nSWZOZWNlc3NhcnkoZ2VvbWV0cnk6IE11bHRpTGluZVN0cmluZykge1xuICBmb3IgKGxldCBsaW5lU3RyaW5nSW5kZXggPSAwOyBsaW5lU3RyaW5nSW5kZXggPCBnZW9tZXRyeS5jb29yZGluYXRlcy5sZW5ndGg7IGxpbmVTdHJpbmdJbmRleCsrKSB7XG4gICAgY29uc3QgbGluZVN0cmluZyA9IGdlb21ldHJ5LmNvb3JkaW5hdGVzW2xpbmVTdHJpbmdJbmRleF07XG4gICAgaWYgKGxpbmVTdHJpbmcubGVuZ3RoID09PSAxKSB7XG4gICAgICAvLyBPbmx5IGEgc2luZ2xlIHBvc2l0aW9uIGxlZnQgb24gdGhpcyBMaW5lU3RyaW5nLCBzbyByZW1vdmUgaXQgKGNhbid0IGhhdmUgUG9pbnQgaW4gTXVsdGlMaW5lU3RyaW5nKVxuICAgICAgZ2VvbWV0cnkuY29vcmRpbmF0ZXMuc3BsaWNlKGxpbmVTdHJpbmdJbmRleCwgMSk7XG4gICAgICAvLyBLZWVwIHRoZSBpbmRleCB0aGUgc2FtZVxuICAgICAgbGluZVN0cmluZ0luZGV4LS07XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHBydW5lTXVsdGlQb2x5Z29uSWZOZWNlc3NhcnkoZ2VvbWV0cnk6IE11bHRpUG9seWdvbikge1xuICBmb3IgKGxldCBwb2x5Z29uSW5kZXggPSAwOyBwb2x5Z29uSW5kZXggPCBnZW9tZXRyeS5jb29yZGluYXRlcy5sZW5ndGg7IHBvbHlnb25JbmRleCsrKSB7XG4gICAgY29uc3QgcG9seWdvbiA9IGdlb21ldHJ5LmNvb3JkaW5hdGVzW3BvbHlnb25JbmRleF07XG4gICAgY29uc3Qgb3V0ZXJSaW5nID0gcG9seWdvblswXTtcblxuICAgIC8vIElmIHRoZSBvdXRlciByaW5nIGlzIG5vIGxvbmdlciBhIHBvbHlnb24sIHJlbW92ZSB0aGUgd2hvbGUgcG9seWdvblxuICAgIGlmIChvdXRlclJpbmcubGVuZ3RoIDw9IDMpIHtcbiAgICAgIGdlb21ldHJ5LmNvb3JkaW5hdGVzLnNwbGljZShwb2x5Z29uSW5kZXgsIDEpO1xuICAgICAgLy8gSXQgd2FzIHJlbW92ZWQsIHNvIGtlZXAgdGhlIGluZGV4IHRoZSBzYW1lXG4gICAgICBwb2x5Z29uSW5kZXgtLTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBob2xlSW5kZXggPSAxOyBob2xlSW5kZXggPCBwb2x5Z29uLmxlbmd0aDsgaG9sZUluZGV4KyspIHtcbiAgICAgIGlmIChyZW1vdmVIb2xlSWZOZWNlc3NhcnkocG9seWdvbiwgaG9sZUluZGV4KSkge1xuICAgICAgICAvLyBJdCB3YXMgcmVtb3ZlZCwgc28ga2VlcCB0aGUgaW5kZXggdGhlIHNhbWVcbiAgICAgICAgaG9sZUluZGV4LS07XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlbW92ZUhvbGVJZk5lY2Vzc2FyeShwb2x5Z29uOiBQb2x5Z29uQ29vcmRpbmF0ZXMsIGhvbGVJbmRleDogbnVtYmVyKSB7XG4gIGNvbnN0IGhvbGUgPSBwb2x5Z29uW2hvbGVJbmRleF07XG4gIGlmIChob2xlLmxlbmd0aCA8PSAzKSB7XG4gICAgcG9seWdvbi5zcGxpY2UoaG9sZUluZGV4LCAxKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG4iXX0=